//@version=5
indicator("BTC M2 Std Dev (Future)", overlay=true, max_polylines_count=100)

// ── Inputs ───────────────────────────────────────────────────
showFuture = input.bool(true, title="Show Future Projection")
baseCol    = input.color(#009AFF, title="Base Color")

// ── Raw Data Arrays ──────────────────────────────────────────
var int[]   times = array.new_int()
var float[] m2    = array.new_float()   // –2σ
var float[] m1    = array.new_float()   // –1σ
var float[] fv    = array.new_float()   // fair value
var float[] p1    = array.new_float()   // +1σ
var float[] p2    = array.new_float()   // +2σ

if barstate.isfirst
    // Populate arrays with all projection points
    array.push(times, timestamp(2025, 6, 26, 0, 0))
    array.push(m2,    94312.76982)
    array.push(m1,    101314.9938)
    array.push(fv,    108317.2178)
    array.push(p1,    115319.4417)
    array.push(p2,    122321.6657)
    array.push(times, timestamp(2025, 6, 29, 0, 0))
    array.push(m2,    102272.217)
    array.push(m1,    109274.441)
    array.push(fv,    116276.665)
    array.push(p1,    123278.8889)
    array.push(p2,    130281.1129)
    array.push(times, timestamp(2025, 6, 30, 0, 0))
    array.push(m2,    102863.7862)
    array.push(m1,    109866.0102)
    array.push(fv,    116868.2341)
    array.push(p1,    123870.4581)
    array.push(p2,    130872.6821)
    array.push(times, timestamp(2025, 7, 1, 0, 0))
    array.push(m2,    104533.5435)
    array.push(m1,    111535.7674)
    array.push(fv,    118537.9914)
    array.push(p1,    125540.2154)
    array.push(p2,    132542.4394)
    array.push(times, timestamp(2025, 7, 2, 0, 0))
    array.push(m2,    108675.0404)
    array.push(m1,    115677.2644)
    array.push(fv,    122679.4883)
    array.push(p1,    129681.7123)
    array.push(p2,    136683.9363)
    array.push(times, timestamp(2025, 7, 3, 0, 0))
    array.push(m2,    106089.004)
    array.push(m1,    113091.228)
    array.push(fv,    120093.452)
    array.push(p1,    127095.6759)
    array.push(p2,    134097.8999)
    array.push(times, timestamp(2025, 7, 6, 0, 0))
    array.push(m2,    102667.41)
    array.push(m1,    109669.634)
    array.push(fv,    116671.858)
    array.push(p1,    123674.082)
    array.push(p2,    130676.3059)
    array.push(times, timestamp(2025, 7, 7, 0, 0))
    array.push(m2,    102578.1307)
    array.push(m1,    109580.3547)
    array.push(fv,    116582.5787)
    array.push(p1,    123584.8027)
    array.push(p2,    130587.0266)
    array.push(times, timestamp(2025, 7, 8, 0, 0))
    array.push(m2,    106368.8067)
    array.push(m1,    113371.0307)
    array.push(fv,    120373.2547)
    array.push(p1,    127375.4786)
    array.push(p2,    134377.7026)
    array.push(times, timestamp(2025, 7, 9, 0, 0))
    array.push(m2,    109396.7147)
    array.push(m1,    116398.9387)
    array.push(fv,    123401.1626)
    array.push(p1,    130403.3866)
    array.push(p2,    137405.6106)
    array.push(times, timestamp(2025, 7, 10, 0, 0))
    array.push(m2,    114089.0588)
    array.push(m1,    121091.2828)
    array.push(fv,    128093.5067)
    array.push(p1,    135095.7307)
    array.push(p2,    142097.9547)
    array.push(times, timestamp(2025, 7, 13, 0, 0))
    array.push(m2,    113348.7473)
    array.push(m1,    120350.9713)
    array.push(fv,    127353.1952)
    array.push(p1,    134355.4192)
    array.push(p2,    141357.6432)
    array.push(times, timestamp(2025, 7, 14, 0, 0))
    array.push(m2,    112088.7203)
    array.push(m1,    119090.9443)
    array.push(fv,    126093.1682)
    array.push(p1,    133095.3922)
    array.push(p2,    140097.6162)
    array.push(times, timestamp(2025, 7, 15, 0, 0))
    array.push(m2,    115350.8934)
    array.push(m1,    122353.1174)
    array.push(fv,    129355.3413)
    array.push(p1,    136357.5653)
    array.push(p2,    143359.7893)
    array.push(times, timestamp(2025, 7, 16, 0, 0))
    array.push(m2,    114792.974)
    array.push(m1,    121795.198)
    array.push(fv,    128797.422)
    array.push(p1,    135799.6459)
    array.push(p2,    142801.8699)
    array.push(times, timestamp(2025, 7, 17, 0, 0))
    array.push(m2,    115561.8221)
    array.push(m1,    122564.046)
    array.push(fv,    129566.27)
    array.push(p1,    136568.494)
    array.push(p2,    143570.7179)
    array.push(times, timestamp(2025, 7, 20, 0, 0))
    array.push(m2,    118995.0637)
    array.push(m1,    125997.2877)
    array.push(fv,    132999.5117)
    array.push(p1,    140001.7356)
    array.push(p2,    147003.9596)
    array.push(times, timestamp(2025, 7, 21, 0, 0))
    array.push(m2,    115097.4377)
    array.push(m1,    122099.6617)
    array.push(fv,    129101.8857)
    array.push(p1,    136104.1096)
    array.push(p2,    143106.3336)
    array.push(times, timestamp(2025, 7, 22, 0, 0))
    array.push(m2,    114489.3408)
    array.push(m1,    121491.5647)
    array.push(fv,    128493.7887)
    array.push(p1,    135496.0127)
    array.push(p2,    142498.2366)
    array.push(times, timestamp(2025, 7, 23, 0, 0))
    array.push(m2,    115934.9214)
    array.push(m1,    122937.1454)
    array.push(fv,    129939.3694)
    array.push(p1,    136941.5934)
    array.push(p2,    143943.8173)
    array.push(times, timestamp(2025, 7, 24, 0, 0))
    array.push(m2,    115057.2761)
    array.push(m1,    122059.5001)
    array.push(fv,    129061.724)
    array.push(p1,    136063.948)
    array.push(p2,    143066.172)
    array.push(times, timestamp(2025, 7, 27, 0, 0))
    array.push(m2,    116728.0061)
    array.push(m1,    123730.2301)
    array.push(fv,    130732.4541)
    array.push(p1,    137734.678)
    array.push(p2,    144736.902)
    array.push(times, timestamp(2025, 7, 28, 0, 0))
    array.push(m2,    117535.9572)
    array.push(m1,    124538.1812)
    array.push(fv,    131540.4052)
    array.push(p1,    138542.6291)
    array.push(p2,    145544.8531)
    array.push(times, timestamp(2025, 7, 29, 0, 0))
    array.push(m2,    116019.22)
    array.push(m1,    123021.444)
    array.push(fv,    130023.668)
    array.push(p1,    137025.8919)
    array.push(p2,    144028.1159)
    array.push(times, timestamp(2025, 7, 30, 0, 0))
    array.push(m2,    114617.3693)
    array.push(m1,    121619.5933)
    array.push(fv,    128621.8172)
    array.push(p1,    135624.0412)
    array.push(p2,    142626.2652)
    array.push(times, timestamp(2025, 7, 31, 0, 0))
    array.push(m2,    114916.5669)
    array.push(m1,    121918.7908)
    array.push(fv,    128921.0148)
    array.push(p1,    135923.2388)
    array.push(p2,    142925.4628)
    array.push(times, timestamp(2025, 8, 3, 0, 0))
    array.push(m2,    116060.7685)
    array.push(m1,    123062.9925)
    array.push(fv,    130065.2165)
    array.push(p1,    137067.4405)
    array.push(p2,    144069.6644)
    array.push(times, timestamp(2025, 8, 4, 0, 0))
    array.push(m2,    121099.0715)
    array.push(m1,    128101.2955)
    array.push(fv,    135103.5195)
    array.push(p1,    142105.7434)
    array.push(p2,    149107.9674)
    array.push(times, timestamp(2025, 8, 5, 0, 0))
    array.push(m2,    118528.6862)
    array.push(m1,    125530.9101)
    array.push(fv,    132533.1341)
    array.push(p1,    139535.3581)
    array.push(p2,    146537.5821)
    array.push(times, timestamp(2025, 8, 6, 0, 0))
    array.push(m2,    115473.7704)
    array.push(m1,    122475.9944)
    array.push(fv,    129478.2184)
    array.push(p1,    136480.4423)
    array.push(p2,    143482.6663)
    array.push(times, timestamp(2025, 8, 7, 0, 0))
    array.push(m2,    116137.1788)
    array.push(m1,    123139.4027)
    array.push(fv,    130141.6267)
    array.push(p1,    137143.8507)
    array.push(p2,    144146.0746)
    array.push(times, timestamp(2025, 8, 10, 0, 0))
    array.push(m2,    113543.2739)
    array.push(m1,    120545.4979)
    array.push(fv,    127547.7218)
    array.push(p1,    134549.9458)
    array.push(p2,    141552.1698)
    array.push(times, timestamp(2025, 8, 11, 0, 0))
    array.push(m2,    115814.2323)
    array.push(m1,    122816.4563)
    array.push(fv,    129818.6803)
    array.push(p1,    136820.9043)
    array.push(p2,    143823.1282)
    array.push(times, timestamp(2025, 8, 12, 0, 0))
    array.push(m2,    115872.7584)
    array.push(m1,    122874.9824)
    array.push(fv,    129877.2063)
    array.push(p1,    136879.4303)
    array.push(p2,    143881.6543)
    array.push(times, timestamp(2025, 8, 13, 0, 0))
    array.push(m2,    116856.9139)
    array.push(m1,    123859.1379)
    array.push(fv,    130861.3619)
    array.push(p1,    137863.5859)
    array.push(p2,    144865.8098)
    array.push(times, timestamp(2025, 8, 14, 0, 0))
    array.push(m2,    116279.14)
    array.push(m1,    123281.364)
    array.push(fv,    130283.5879)
    array.push(p1,    137285.8119)
    array.push(p2,    144288.0359)
    array.push(times, timestamp(2025, 8, 17, 0, 0))
    array.push(m2,    117857.4389)
    array.push(m1,    124859.6628)
    array.push(fv,    131861.8868)
    array.push(p1,    138864.1108)
    array.push(p2,    145866.3347)
    array.push(times, timestamp(2025, 8, 18, 0, 0))
    array.push(m2,    118526.8477)
    array.push(m1,    125529.0717)
    array.push(fv,    132531.2957)
    array.push(p1,    139533.5196)
    array.push(p2,    146535.7436)
    array.push(times, timestamp(2025, 8, 19, 0, 0))
    array.push(m2,    120822.7299)
    array.push(m1,    127824.9539)
    array.push(fv,    134827.1779)
    array.push(p1,    141829.4018)
    array.push(p2,    148831.6258)
    array.push(times, timestamp(2025, 8, 20, 0, 0))
    array.push(m2,    119729.8958)
    array.push(m1,    126732.1198)
    array.push(fv,    133734.3438)
    array.push(p1,    140736.5677)
    array.push(p2,    147738.7917)
    array.push(times, timestamp(2025, 8, 21, 0, 0))
    array.push(m2,    123660.8886)
    array.push(m1,    130663.1126)
    array.push(fv,    137665.3365)
    array.push(p1,    144667.5605)
    array.push(p2,    151669.7845)
    array.push(times, timestamp(2025, 8, 24, 0, 0))
    array.push(m2,    123557.4595)
    array.push(m1,    130559.6834)
    array.push(fv,    137561.9074)
    array.push(p1,    144564.1314)
    array.push(p2,    151566.3554)
    array.push(times, timestamp(2025, 8, 25, 0, 0))
    array.push(m2,    121175.2182)
    array.push(m1,    128177.4421)
    array.push(fv,    135179.6661)
    array.push(p1,    142181.8901)
    array.push(p2,    149184.1141)
    array.push(times, timestamp(2025, 8, 26, 0, 0))
    array.push(m2,    120195.2549)
    array.push(m1,    127197.4789)
    array.push(fv,    134199.7029)
    array.push(p1,    141201.9269)
    array.push(p2,    148204.1508)
    array.push(times, timestamp(2025, 8, 27, 0, 0))
    array.push(m2,    122347.5815)
    array.push(m1,    129349.8055)
    array.push(fv,    136352.0294)
    array.push(p1,    143354.2534)
    array.push(p2,    150356.4774)
    array.push(times, timestamp(2025, 8, 28, 0, 0))
    array.push(m2,    121157.9106)
    array.push(m1,    128160.1346)
    array.push(fv,    135162.3585)
    array.push(p1,    142164.5825)
    array.push(p2,    149166.8065)
    array.push(times, timestamp(2025, 8, 29, 0, 0))
    array.push(m2,    121908.6562)
    array.push(m1,    128910.8801)
    array.push(fv,    135913.1041)
    array.push(p1,    142915.3281)
    array.push(p2,    149917.5521)
    array.push(times, timestamp(2025, 8, 31, 0, 0))
    array.push(m2,    124411.1595)
    array.push(m1,    131413.3835)
    array.push(fv,    138415.6075)
    array.push(p1,    145417.8314)
    array.push(p2,    152420.0554)
    array.push(times, timestamp(2025, 9, 1, 0, 0))
    array.push(m2,    123208.2112)
    array.push(m1,    130210.4352)
    array.push(fv,    137212.6592)
    array.push(p1,    144214.8831)
    array.push(p2,    151217.1071)
    array.push(times, timestamp(2025, 9, 2, 0, 0))
    array.push(m2,    124884.7436)
    array.push(m1,    131886.9675)
    array.push(fv,    138889.1915)
    array.push(p1,    145891.4155)
    array.push(p2,    152893.6395)
    array.push(times, timestamp(2025, 9, 3, 0, 0))
    array.push(m2,    125505.137)
    array.push(m1,    132507.361)
    array.push(fv,    139509.585)
    array.push(p1,    146511.809)
    array.push(p2,    153514.0329)
    array.push(times, timestamp(2025, 9, 4, 0, 0))
    array.push(m2,    122993.7561)
    array.push(m1,    129995.9801)
    array.push(fv,    136998.204)
    array.push(p1,    144000.428)
    array.push(p2,    151002.652)
    array.push(times, timestamp(2025, 9, 7, 0, 0))
    array.push(m2,    124095.6209)
    array.push(m1,    131097.8449)
    array.push(fv,    138100.0688)
    array.push(p1,    145102.2928)
    array.push(p2,    152104.5168)
    array.push(times, timestamp(2025, 9, 8, 0, 0))
    array.push(m2,    123409.08)
    array.push(m1,    130411.3039)
    array.push(fv,    137413.5279)
    array.push(p1,    144415.7519)
    array.push(p2,    151417.9759)
    array.push(times, timestamp(2025, 9, 9, 0, 0))
    array.push(m2,    124417.7517)
    array.push(m1,    131419.9757)
    array.push(fv,    138422.1997)
    array.push(p1,    145424.4237)
    array.push(p2,    152426.6476)
    array.push(times, timestamp(2025, 9, 10, 0, 0))
    array.push(m2,    127855.9602)
    array.push(m1,    134858.1842)
    array.push(fv,    141860.4081)
    array.push(p1,    148862.6321)
    array.push(p2,    155864.8561)
    array.push(times, timestamp(2025, 9, 11, 0, 0))
    array.push(m2,    126449.5658)
    array.push(m1,    133451.7897)
    array.push(fv,    140454.0137)
    array.push(p1,    147456.2377)
    array.push(p2,    154458.4617)
    array.push(times, timestamp(2025, 9, 14, 0, 0))
    array.push(m2,    126351.9464)
    array.push(m1,    133354.1704)
    array.push(fv,    140356.3944)
    array.push(p1,    147358.6184)
    array.push(p2,    154360.8423)
    array.push(times, timestamp(2025, 9, 15, 0, 0))
    array.push(m2,    124061.1085)
    array.push(m1,    131063.3325)
    array.push(fv,    138065.5564)
    array.push(p1,    145067.7804)
    array.push(p2,    152070.0044)
    array.push(times, timestamp(2025, 9, 16, 0, 0))
    array.push(m2,    123848.8774)
    array.push(m1,    130851.1014)
    array.push(fv,    137853.3253)
    array.push(p1,    144855.5493)
    array.push(p2,    151857.7733)
    array.push(times, timestamp(2025, 9, 17, 0, 0))
    array.push(m2,    123968.7392)
    array.push(m1,    130970.9632)
    array.push(fv,    137973.1871)
    array.push(p1,    144975.4111)
    array.push(p2,    151977.6351)
    array.push(times, timestamp(2025, 9, 18, 0, 0))
    array.push(m2,    125729.2155)
    array.push(m1,    132731.4395)
    array.push(fv,    139733.6635)
    array.push(p1,    146735.8874)
    array.push(p2,    153738.1114)
    array.push(times, timestamp(2025, 9, 21, 0, 0))
    array.push(m2,    126054.2592)
    array.push(m1,    133056.4832)
    array.push(fv,    140058.7071)
    array.push(p1,    147060.9311)
    array.push(p2,    154063.1551)
    array.push(times, timestamp(2025, 9, 22, 0, 0))
    array.push(m2,    127558.3366)
    array.push(m1,    134560.5605)
    array.push(fv,    141562.7845)
    array.push(p1,    148565.0085)
    array.push(p2,    155567.2325)
    array.push(times, timestamp(2025, 9, 23, 0, 0))
    array.push(m2,    127527.7648)
    array.push(m1,    134529.9888)
    array.push(fv,    141532.2128)
    array.push(p1,    148534.4368)
    array.push(p2,    155536.6607)

// ── One-Time Draw ────────────────────────────────────────────
var bool drawn = false
if showFuture and not drawn and barstate.islastconfirmedhistory
    drawn := true

    // Build point arrays for each band
    var array<chart.point> pts_m2 = array.new<chart.point>()
    var array<chart.point> pts_m1 = array.new<chart.point>()
    var array<chart.point> pts_fv = array.new<chart.point>()
    var array<chart.point> pts_p1 = array.new<chart.point>()
    var array<chart.point> pts_p2 = array.new<chart.point>()
    for i = 0 to array.size(times) - 1
        t = array.get(times, i)
        array.push(pts_m2, chart.point.from_time(t, array.get(m2, i)))
        array.push(pts_m1, chart.point.from_time(t, array.get(m1, i)))
        array.push(pts_fv, chart.point.from_time(t, array.get(fv, i)))
        array.push(pts_p1, chart.point.from_time(t, array.get(p1, i)))
        array.push(pts_p2, chart.point.from_time(t, array.get(p2, i)))

    // Draw each band as a single polyline with specified transparency
    polyline.new(points=pts_p2, xloc=xloc.bar_time, line_color=color.new(baseCol, 65), line_width=2)
    polyline.new(points=pts_p1, xloc=xloc.bar_time, line_color=color.new(baseCol, 45), line_width=2)
    polyline.new(points=pts_fv, xloc=xloc.bar_time, line_color=color.new(baseCol, 5),  line_width=2)
    polyline.new(points=pts_m1, xloc=xloc.bar_time, line_color=color.new(baseCol, 45), line_width=2)
    polyline.new(points=pts_m2, xloc=xloc.bar_time, line_color=color.new(baseCol, 65), line_width=2)

// Dummy plot for overlay
plot(na)
